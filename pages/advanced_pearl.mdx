---
title: Advanced Pearl
icon: "diagram-subtask"
iconType: "light"
---

The Conversation Tree Editor is a powerful tool that allows you to design and visualize conversation flows in a user-friendly, visual interface. Whether you're creating customer surveys, support dialogues, or interactive voice responses, this editor helps you craft natural and personalized conversations.

<div className="block dark:hidden">
  <Frame>
    <div className="p-4">
      <img
        src="/images/dark_mode/tree.gif"
        alt="Send Email action interface on light mode"
        className="rounded-[14px]"
      />
    </div>
  </Frame>
</div>

<div className="hidden dark:block">
  <Frame>
    <div className="p-4">
      <img
        src="/images/dark_mode/tree.gif"
        alt="Send Email action interface on dark mode"
        className="rounded-[14px]"
      />
    </div>
  </Frame>
</div>

---

## Getting Started

### Main Interface Overview

When you open the Conversation Tree Editor, you'll see the main workspace divided into several key areas:

- **Bottom Bar**: Contains navigation buttons, settings, the auto-generate feature, and save options.
- **Sidebar**: Offers various node subtypes to add to your conversation flow.
- **Canvas**: The central area where you'll build and visualize your conversation tree.
- **Variable Management Panel**: Accessed via the sidebar, it allows you to manage variables used in your flow.

### Creating a New Conversation Flow

1. **Start a New Flow**: Click on the **"New Flow"** button or select an existing template.
2. **Name Your Flow**: Give your conversation flow a descriptive name to easily identify it later.
3. **Save Your Work**: Regularly click the **"Save"** button in the top bar to save your progress.

## Building Your Conversation Flow

### Adding Nodes

Nodes are the building blocks of your conversation flow. Each node represents a point in the conversation where the agent interacts with the customer. The sidebar contains the node subtypes, which are:

- **Dialogue Nodes**: For asking questions and receiving answers.
- **Action Nodes**: For performing actions like sending emails, SMS messages, booking appointments, or transferring calls.
- **End Nodes**: For ending the conversation gracefully.

#### Dialogue Nodes

- **Purpose**: To ask questions and collect responses from the user.
- **How to Add**:
  - Click on the **Dialogue Node** icon (chat bubble) in the sidebar.
  - Drag and drop it onto the canvas.
- **Usage**: Ideal for greetings, collecting user information, and any interaction requiring user input.

#### Action Nodes

- **Purpose**: To perform specific actions based on user responses.
- **Available Action Nodes**:
  - **Email Node**: Sends an automated email to the user.
  - **SMS Node**: Sends a text message in real-time during the conversation.
  - **Booking Node**: Schedules appointments or reservations.
  - **Taking Message Node**: Records and stores messages from the user.
  - **Transfer Call Node**: Transfers the call to a live agent (this action ends the conversation with the agent).
  - **API Node**: Integrates with external systems via API calls.
- **How to Add**:
  - Select the appropriate Action Node icon from the sidebar.
  - Drag and drop it onto the canvas.
- **Usage**:
  - Use action nodes at various stages in the conversation to perform tasks like sending information or booking appointments.
  - **Note**: The **Transfer Call** action will end the conversation with the agent, so it should be used when you intend to transfer the call to a human representative.

#### End Call Nodes

- **Purpose**: To gracefully end the conversation.
- **How to Add**:
  - Click on the **End Node** icon in the sidebar.
  - Place it at the point where the conversation should conclude.
- **Usage**: Always ensure your flow ends with an End Call node to signal the conversation's closure.

### Configuring Nodes

After adding nodes, you'll need to configure them to define their behavior and content.

#### Writing Agent Scripts

- **Script Field**: Each node has a script field where you write what the agent will say.
- **Tips**:
  - Use a friendly and professional tone.
  - Keep messages clear and concise.
  - Personalize messages using variables (e.g., "Hello {customerName}").

#### Storing User Responses

- **Variables**: Collect and store user responses in variables for later use.
- **How to Assign**:
  - In the node configuration, find the **"Store In Variable"** section.
  - Select an existing variable or create a new one.
- **Usage**: Variables can be used to personalize scripts, set conditions for transitions, and be included in actions like emails or SMS messages.

#### Using Variables in Actions

- **Incorporating Variables**: When configuring action nodes, you can use variables to personalize the content.
- **Example in SMS Node**:
  - **Message Content**: "Hello {customerName}, here is the link you requested: {linkURL}"
  - Use the **"+"** button next to the text box to add variables.
- **Available in All Actions**: Variables can be used in Email, SMS, Booking, API calls, etc.

#### Setting Up Transitions

Transitions define how the conversation moves from one node to the next based on user responses or conditions.

##### Adding Transitions

1. **From a Node**: Click on the node from which you want to create a transition.
2. **Drag Transition Line**: Click and drag from the transition point (often a small circle or arrow) to the target node.
3. **Label the Transition**: Give the transition a clear and descriptive label that reflects the condition or response (e.g., "Yes", "No", "Email Provided").

##### Editing Transitions

- **Adjusting Connections**:
  - To change a transition, click on the transition line and drag it to a different node.
- **Deleting Transitions**:
  - Click on the transition line and press the delete key, or use the delete icon in the node's transition settings.
- **Adding Conditions**:
  - In the node's configuration panel, you can add new transitions by clicking the **"+"** button.

##### Conditional Transitions

- **Purpose**: To define different paths based on specific conditions or user inputs.
- **How to Enable**:
  - In the node configuration, toggle **"Conditional Transitions"** on.
- **Setting Conditions**:
  - Define conditions based on variables (e.g., if `satisfactionLevel` is greater than 4).
  - Label each conditional path clearly.
- **Benefits**:
  - Allows for dynamic and personalized conversation flows.
  - Ensures users receive relevant responses and actions based on their input.

**Example**:

- **Question**: "Would you like to receive updates via email?"
- **Transitions**:
  - **Yes**: Connects to the node where the email is collected.
  - **No**: Connects to the next appropriate node or ends the conversation.

## Using the Sidebar Tools

The sidebar provides quick access to various node subtypes and tools to enhance your conversation flow:

- **Dialogue Nodes**: Use these to ask questions and receive user input.
- **Action Nodes**:
  - **Email Node**: Send automated emails.
  - **SMS Node**: Send text messages in real-time.
  - **Booking Node**: Schedule appointments or reservations.
  - **Taking Message Node**: Record messages from the user.
  - **Transfer Call Node**: Transfer the call to a live agent.
  - **API Node**: Perform API calls and integrate with external systems.
- **End Nodes**: Conclude the conversation.
- **Variable Management**: Create and manage variables.
- **Transition Tools**: Manage transitions and define the flow between nodes.

**Tip**: Hover over each icon to see its function and a brief description.

## Managing Variables

Variables are essential for creating dynamic and personalized conversations.

- **Accessing Variables**:
  - Click on the **Variables** icon in the sidebar.
- **Creating a Variable**:
  - Click on **"Add New"**.
  - Provide a name (use camelCase, e.g., `customerName`).
- **Editing Variables**:
  - Click the **Edit** icon next to a variable.
  - Modify the name or settings as needed.
- **Deleting Variables**:
  - Click the **Delete** icon, but ensure it's not used elsewhere in your flow.

### Variable Configuration Screen

The **Variable Configuration Screen** allows you to define, manage, and customize variables used in your conversation flow.

#### Details Tab

- **Type Selection**:
  - Choose the data type for the variable (e.g., **String**, **Number**, **Boolean**).
- **Name Field**:
  - Provide a descriptive name for the variable.
- **Update Button**:
  - Click **Update** to save any changes made.

#### Options Tab

Use the **Options Tab** when the variable requires predefined selectable options, such as multiple-choice questions.

- **Enable Coded Values**:
  - Toggle **Coded Values** on or off.
  - **On**: Assign numerical codes to each option (useful for data analysis).
  - **Off**: Store options as plain text.
- **Adding Options**:
  - Enter the option text (e.g., "Customer Service", "Pricing").
  - If **Coded Values** are enabled, assign a code to each option.
- **Deleting Options**:
  - Click the **Delete** icon next to an option to remove it.
- **Update Button**:
  - Click **Update** to save the options.

**Example with Coded Values Enabled**:

- **Option List**:
  - "Customer Service" - Code: `1`
  - "Pricing" - Code: `2`
  - "Product Quality" - Code: `3`

**Using Variables in Scripts**:

- Include variables in your agent's script using curly braces.
- Example: "Thank you for your feedback on {improvementAreas}!"

**Best Practices for Variables**:

1. **Use Clear Names**: Choose descriptive names for clarity.
2. **Enable Coded Values When Needed**: Useful for data analysis.
3. **Keep Options Updated**: Reflect current business needs.
4. **Test Variables**: Ensure they work correctly in the flow.

## Using the Auto-Generate Feature

The Conversation Tree Editor includes an **Auto-Generate** feature that allows you to quickly create a conversation flow based on a script or description.

### How It Works

1. **Accessing the Feature**:
   - Click on the **Auto-Generate** icon (magic wand or star) in the top bar.
2. **Input Your Script or Description**:
   - A text box will appear where you can paste your script or describe the conversation flow you want to create.
   - Be as detailed as possible to ensure accurate generation.
3. **Generate the Flow**:
   - Click the **"Generate"** button.
   - The editor will process your input and automatically create a conversation flow on the canvas.
4. **Review and Customize**:
   - Once generated, review the flow to ensure it meets your requirements.
   - Make any necessary adjustments or additions.

### Benefits of the Auto-Generate Feature

- **Saves Time**: Quickly creates a baseline flow without manual node placement.
- **Consistency**: Ensures that the generated flow follows logical structures and best practices.
- **Customization**: Allows for easy tweaking and personalization after generation.

**Note**: The Auto-Generate feature is designed to assist you, but always review the generated flow for accuracy and completeness.

## Pre-Call API

The **Pre-Call API** lets you fetch external data—such as customer information—*before* the main conversation flow begins. By retrieving details from an external system, you can personalize your call experience and streamline the flow based on real-time data.

### Configuring the Pre-Call API

1. **Endpoint & Method**  
   - Enter the API endpoint (e.g., `https://platform.nlpearl.ai/customer/{phone_number}`) and select the HTTP method (e.g., **GET**).

2. **Headers (Optional)**  
   - If your API requires special headers (like authorization tokens), add them here.

3. **Response Mappings**  
   - In the **Response** section, map each JSON key from your API response to a corresponding variable in the conversation flow.
   - For each key, mark it as **Required** or **Optional**:
     - **Required**: If *any* required key is missing, the outcome is **Not Success**.
     - **Optional**: Missing keys do *not* affect the success outcome.
   - When all required fields are present, the flow transitions to **Success**.

4. **Combine Transition**  
   - Enable **Combine Transition** if you do *not* need separate **Success** and **Not Success** paths. This merges both outcomes into a single flow path, regardless of the response.



### Using Pre-Call Variables

Any variables populated by the Pre-Call API become available to all subsequent nodes. This allows you to:

  - **Personalize**: responses using the fetched data (for example: "Hello, `{Customer Name}`").
  - **Branch Logic**: more accurately, based on known user attributes (for example: customer ID or email).

### Example

Below are two images illustrating the Pre-Call API in action:

1. **Flow Example Using the Pre-Call API**  

<div className="block dark:hidden">
  <Frame>
    <div className="p-4">
      <img
        src="/images/light_mode/api-pre-call-tree.jpg"
        alt="Send Email action interface on light mode"
        className="rounded-[14px]"
      />
    </div>
  </Frame>
</div>

<div className="hidden dark:block">
  <Frame>
    <div className="p-4">
      <img
        src="/images/dark_mode/api-pre-call-tree.jpg"
        alt="Send Email action interface on dark mode"
        className="rounded-[14px]"
      />
    </div>
  </Frame>
</div>

   In this example, the conversation will follow the **Success** path if the required fields are found; otherwise, it transitions to **Not Success**.

2. **Pre-Call API Configuration**  

<div className="block dark:hidden">
  <Frame>
    <div className="p-4">
      <img
        src="/images/light_mode/api-pre-call-settings.jpg"
        alt="Send Email action interface on light mode"
        className="rounded-[14px]"
      />
    </div>
  </Frame>
</div>

<div className="hidden dark:block">
  <Frame>
    <div className="p-4">
      <img
        src="/images/dark_mode/api-pre-call-settings.jpg"
        alt="Send Email action interface on dark mode"
        className="rounded-[14px]"
      />
    </div>
  </Frame>
</div>

This screenshot shows how to specify your endpoint, configure headers, map JSON keys to variables, and set the required/optional status.

For more details on connecting to external systems, see our [API page](/pages/api_action).

---


## Best Practices

- **Plan Your Flow**: Sketch out the conversation flow before building it.
- **Use Clear Language**: Ensure scripts are easy to understand.
- **Personalize Interactions**: Use variables to make the conversation feel tailored.
- **Test Your Flow**: Simulate conversations to identify any issues.
- **Cover All Scenarios**: Anticipate various user responses and handle them appropriately.
- **Keep It Natural**: Aim for a conversational tone that mimics human interaction.
- **Use Actions Strategically**:
  - Incorporate action nodes at appropriate stages to enhance user experience.
  - Remember that you can use multiple actions throughout the conversation.
  - The **Transfer Call** action will end the conversation with the agent, so use it when appropriate.
- **Label Transitions Clearly**:
  - Use descriptive labels for transitions to maintain clarity.
  - Example: "Email Provided", "Email Not Provided", "User Agrees".
- **Regularly Save Your Work**: Use the save button to prevent loss of progress.

## Examples

### Example 1: Customer Satisfaction Survey

1. **Greeting Node**:
   - **Script**: "Hello! Thank you for calling XYZ Company. My name is {agentName}."
2. **Satisfaction Dialogue Node (Dialogue)**:
   - **Script**: "On a scale of 1 to 5, how satisfied are you with our service?"
   - **Store Response In**: `satisfactionLevel`
   - **Conditional Transitions**:
     - **If 4 or above**: Proceed to Positive Feedback Node.
     - **If below 4**: Proceed to Improvement Inquiry Node.
3. **Positive Feedback Node**:
   - **Script**: "We're glad you're satisfied! Would you like to receive updates via SMS?"
   - **Options**: Yes or No.
4. **Improvement Inquiry Node**:
   - **Script**: "We're sorry to hear that. Could you tell us how we can improve?"
   - **Store Response In**: `improvementAreas`
   - **Options Configuration**:
     - Enable **Coded Values** if needed.
     - Provide options like "Customer Service", "Pricing", "Product Quality".
5. **Email Request Node (Dialogue)**:
   - **Script**: "Could you please provide your email address so we can send you a summary of your responses?"
   - **Store Response In**: `customerEmail`
   - **Transitions**:
     - **Email Provided**: Proceed to Email Confirmation Node.
     - **Email Not Provided**: Proceed to End Call Node.
6. **Email Confirmation Node**:
   - **Script**: "Thank you! We will send the summary to {customerEmail}."
7. **SMS Action Node**:
   - **Purpose**: Send a personalized SMS in real-time.
   - **Configuration**:
     - **Message Content**: "{customerName}, here is the link for your summary: https://xyzcompany.com/summary"
     - **Variables Used**: `customerName`
     - **Add Variables**: Use the "+" button to insert variables into your message.
     - **Conditional Transitions**: Enable if you want to send the SMS only under certain conditions.
8. **End Call Node**:
   - **Script**: "Thank you for your time. Have a great day!"

### Setting Up Transitions in the Example

- **From Email Request Node**:
  - **Email Provided**:
    - **Connect**: Drag the transition line from "Email Provided" to the **Email Confirmation Node**.
    - **Label**: Ensure the transition is labeled "Email Provided" for clarity.
  - **Email Not Provided**:
    - **Connect**: Drag the transition line from "Email Not Provided" to the **End Call Node**.
    - **Label**: Label the transition accordingly.
- **Editing Transitions**:
  - To adjust connections, click and drag the transition lines to the desired nodes.
  - To delete a transition, click on it and press delete or use the delete icon.

**Benefits of Clear Transitions**:

- **Visual Clarity**: Easily see the flow paths and how nodes are connected.
- **Logical Flow**: Ensure the conversation progresses logically based on user responses.
- **Ease of Editing**: Quickly adjust the flow by dragging transitions without deleting nodes.

---

## Frequently Asked Questions (FAQ)

<AccordionGroup>
  <Accordion title="How do I test my conversation flow?">
    Use the simulation feature to walk through the conversation as if you were the user.
  </Accordion>

    <Accordion title="Can I import existing scripts into the editor?">
    Yes, use the **Auto-Generate** feature to generate flows from your scripts or descriptions.
  </Accordion>

    <Accordion title="How do I handle unexpected user responses?">
    Include default transitions or error-handling nodes to manage unanticipated inputs.
  </Accordion>

    <Accordion title="Can I customize the actions performed by Action Nodes?">
    Yes, configure each action node using variables and settings provided.
  </Accordion>

    <Accordion title="How do I use variables with Action Nodes like Email or SMS?">
    When configuring the action, insert variables into the content fields (e.g., message body, recipient address).
  </Accordion>

    <Accordion title="Can I use multiple actions in my conversation flow?">
    Yes, you can include multiple actions at different stages, except for the **Transfer Call** action, which ends the conversation with the agent.
  </Accordion>

    <Accordion title="How do I set up conditional transitions?">
In the node configuration, enable **"Conditional Transitions"**, define your conditions, and label each transition clearly.
  </Accordion>

</AccordionGroup>

---

## Conclusion

The Conversation Tree Editor empowers you to create dynamic and personalized conversations with ease. By leveraging nodes, variables, transitions, and actions, you can craft engaging dialogues that enhance customer experience.

Remember to plan your flow carefully, use clear labels, and test thoroughly to ensure a seamless user experience.

---

For further assistance, please consult the support resources or contact our help desk.

